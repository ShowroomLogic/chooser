/*! chooser 2014-01-04 */
angular.module("chooser",["chooser.dropdown","chooser.single","chooser.multiple","chooser.tags","chooser.templates"]).filter("chooserLabelFilter",function(){"use strict";return function(a,b){return angular.isUndefined(b)?a:angular.isObject(a)&&a.hasOwnProperty(b)?a[b]:a}}),angular.module("chooser.dropdown",[]).directive("chooserDropdown",["$document","$location","$filter","$rootScope",function(a,b,c,d){"use strict";var e,f=angular.noop,g=angular.noop;return{restrict:"E",require:["?^chooser","?^chooserMultiple","?^chooserTags"],templateUrl:"templates/chooser.dropdown.html",link:function(b,h,i,j){var k=j[0]||j[1]||j[2];if(!k)throw new Error("No controller was found to use for the chooser dropdown.");var l=function(){var a=c("filter")(b.items,b.$search);angular.isArray(b.selectedItems)&&(a=_.difference(a,b.selectedItems)),b.filteredItems=a};b.$watch("$search",l),b.$watch("model",l,!0),b.$watch("items",l,!0),b.selectOption=function(a,b){k.chooseOption(b),f(a)},b.highlightedIndex=0;var m=function(){b.highlightedIndex>0&&b.$apply(function(){b.highlightedIndex--})},n=function(){b.highlightedIndex<b.filteredItems.length-1&&b.$apply(function(){b.highlightedIndex++})},o=function(){var a=0;if(b.model&&!angular.isArray(b.model))for(var c=0;c<b.filteredItems.length;c++)if(angular.equals(b.selectedItem,b.filteredItems[c])){a=c;break}b.highlightedIndex=a};b.$on("$locationChangeStart",f),b.openMenu=function(c){var i=h.closest(".chooser"),j=i.hasClass("open"),k=h.find("input").eq(0);c.preventDefault&&c.preventDefault(),c.stopPropagation&&c.stopPropagation(),j?f():i.hasClass("disabled")||i.attr("disabled")||(e&&d.$broadcast("closeChooser_"+e),e=b.$id,i.addClass("open"),k[0].focus(),o(),b.$search="",f=function(b){b&&b.preventDefault&&b.preventDefault(),b&&b.stopPropagation&&b.stopPropagation(),a.off("click",f),a.off("keydown",g),i.removeClass("open"),f=angular.noop,g=angular.noop},a.on("click",f),g=function(a){switch(a.which){case 38:m();break;case 40:n();break;case 13:var c=b.filteredItems[b.highlightedIndex];c?b.$apply(function(){b.selectOption(a,c)}):f(a);break;case 9:case 27:f(a)}},a.on("keydown",g)),b.$on("closeChooser_"+b.$id,function(){f()})}}}}]),angular.module("chooser.single",["chooser.dropdown"]).directive("chooser",["$filter",function(a){"use strict";return{restrict:"E",replace:!0,templateUrl:"templates/chooser.single.tpl.html",scope:{labelKey:"@",valueKey:"@",items:"=options",model:"=ngModel",placeholder:"=placeholder"},controller:["$scope",function(a){this.chooseOption=function(b){a.selectedItem=b,a.model=a.valueKey?a.selectedItem[a.valueKey]:a.selectedItem}}],link:function(b,c){b.map={};var d=function(){var d=a("chooserLabelFilter")(b.selectedItem,b.labelKey),e=d&&d.length,f=e?d:b.placeholder||"Select";c.find(".chosen-text").toggleClass("placeholder",!e).html(f)};b.$watch("model",function(a){b.selectedItem=b.valueKey?b.map[a]:a,d()}),b.$watch("placeholder",function(){d()}),b.$watch("items",function(a){if(b.map={},b.selectedItem=null,b.valueKey&&a){for(var c=0;c<a.length;c++)b.map[a[c][b.valueKey]]=a[c];b.selectedItem=b.map[b.model]}d()})}}}]),angular.module("chooser.multiple",["chooser.dropdown"]).directive("chooserMultiple",function(){"use strict";return{restrict:"E",replace:!0,templateUrl:"templates/chooser.multiple.html",scope:{labelKey:"@",valueKey:"@",items:"=options",model:"=ngModel",placeholder:"=placeholder"},controller:["$scope",function(a){this.chooseOption=function(b){a.selectedItems.push(b),a.model=a.valueKey?angular.isArray(a.model)?a.model.concat([b[a.valueKey]]):[b[a.valueKey]]:angular.isArray(a.model)?a.model.concat([b]):[b]}}],link:function(a){a.map={},a.selectedItems=[],a.$watch("model",function(b){var c=[];if(angular.isArray(b))for(var d=0;d<b.length;d++){var e=a.valueKey?a.map[b[d]]:b;if(e)c.push(e);else if(a.labelKey)if(a.valueKey){var f={};f[a.labelKey]="Invalid Option",f[a.valueKey]=b[d],f._invalid=!0,c.push(f)}else c.push(b[d]);else c.push(b[d])}a.selectedItems=c}),a.$watch("placeholder",function(){}),a.$watch("items",function(b){if(a.map={},a.valueKey&&b)for(var c=0;c<b.length;c++)a.map[b[c][a.valueKey]]=b[c];var d=[];if(angular.isArray(a.model))for(var c=0;c<a.model.length;c++)d.push(a.valueKey?a.map[a.model[c]]:a.model);a.selectedItems=d}),a.removeOption=function(b,c){b&&(b.preventDefault(),b.stopPropagation()),console.log(c);var d=a.selectedItems.indexOf(c);if(-1!==d&&a.selectedItems.splice(d,1),a.valueKey)var e=a.model.indexOf(c[a.valueKey]);else var e=a.model.indexOf(c);-1!==e&&a.model.splice(e,1)}}}}),angular.module("chooser.tags",[]).directive("chooserTags",function(){"use strict";return{restrict:"E",require:"chooserTags",templateUrl:"templates/chooser.tags.tpl.html",scope:{items:"=options",model:"=ngModel",placeholder:"@placeholder"},controller:["$scope",function(a){this.chooseOption=function(b){angular.isArray(a.model)?-1===a.model.indexOf(b)&&(a.model=a.model.concat([b])):a.model=[b]}}],link:function(a,b,c,d){var e=b.find("input").eq(0),f=function(b){switch(b.which){case 13:a.$apply(function(){e.val().length&&d.chooseOption(e.val()),a.newTag=""});break;case 27:e.blur()}},g=function(){e.bind("keydown",f),e.bind("blur",h),e[0].focus()};a.focusInput=g;var h=function(){a.newTag="",e.unbind("keydown",f),e.unbind("blur",h)};a.removeOption=function(b,c){b&&(b.preventDefault(),b.stopPropagation());var d=a.model.indexOf(c);-1!==d&&a.model.splice(d,1)}}}}),angular.module("chooser.templates",["templates/chooser.dropdown.html","templates/chooser.multiple.html","templates/chooser.single.tpl.html","templates/chooser.tags.tpl.html"]),angular.module("templates/chooser.dropdown.html",[]).run(["$templateCache",function(a){a.put("templates/chooser.dropdown.html",'<ul class="chooser-dropdown">\n	<li class="chooser-dropdown-search">\n		<input type="text" ng-model="$search" ng-click="$event.stopPropagation();" placeholder="Search" />\n	</li>\n	<li ng-show="filteredItems.length" ng-repeat="item in filteredItems" ng-mouseover="$parent.highlightedIndex = $index">\n		<a ng-class="{ highlight: highlightedIndex === $index }" href ng-click="selectOption($event, item)" tabindex="-1">{{ item | chooserLabelFilter:labelKey }}</a>\n	</li>\n	<li ng-hide="filteredItems.length" class="no-matches-found">\n		<span>No Matches Found</span>\n	</li>\n</ul>')}]),angular.module("templates/chooser.multiple.html",[]).run(["$templateCache",function(a){a.put("templates/chooser.multiple.html",'<div class="chooser chooser-multiple">\n	<div class="chooser-chosens" ng-click="openMenu($event)">\n		<div class="chooser-chosen" ng-repeat="item in selectedItems" ng-class="{invalid: item._invalid}">\n			{{ item | chooserLabelFilter:labelKey }}\n			<a class="chooser-remove-link" href ng-click="removeOption($event, item)">\n				<i class="chooser-remove-icon"></i>\n			</a>\n		</div>\n		<div class="chooser-chosen-add-container">\n			<div class="chooser-chosen-add">\n				<span class="chooser-placeholder" ng-bind="placeholder" ng-show="placeholder"></span>\n				<i class="chooser-add-icon"></i>\n			</div>\n		</div>\n	</div>\n	<chooser-dropdown></chooser-dropdown>\n</div>')}]),angular.module("templates/chooser.single.tpl.html",[]).run(["$templateCache",function(a){a.put("templates/chooser.single.tpl.html",'<div class="chooser chooser-single">\n	<button type="button" class="chooser-toggle" ng-click="openMenu($event)">\n		<span class="chosen-text"></span>\n		<span class="caret-container">\n			<span class="caret"></span>\n		</span>\n	</button>\n	<chooser-dropdown></chooser-dropdown>\n</div>')}]),angular.module("templates/chooser.tags.tpl.html",[]).run(["$templateCache",function(a){a.put("templates/chooser.tags.tpl.html",'<div class="chooser chooser-multiple chooser-tags">\n	<div class="chooser-chosens" ng-click="focusInput($event)">\n		<div class="chooser-chosen" ng-repeat="item in model">\n			{{ item }} <a class="chooser-remove chooser-remove-link" href ng-click="removeOption($event, item)">&times;</a>\n		</div>\n		<div class="chooser-chosen-add-container">\n			<div class="chooser-chosen-add fa fa-plus"></div>\n			<input type="text" ng-model="newTag" size="{{ newTag.length || \'1\' }}" />\n		</div>\n		<div class="chooser-chosen-add-container">\n			<div class="chooser-chosen-add">\n				<i class="chooser-add-icon"></i>\n			</div>\n			<input type="text" ng-model="newTag" size="{{ newTag.length || \'1\' }}" />\n		</div>\n	</div>\n</div>')}]);